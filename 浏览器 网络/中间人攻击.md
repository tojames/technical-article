# 中间人攻击（MITM）

> **原理**：中间人攻击是一种通过各种技术手段入侵两台设备通信的网络攻击方法。
>
> 从广义上讲，MITM 攻击相当于邮递员打开您的银行对帐单，写下您的帐户详细信息，然后重新密封信封并将其送到您家门口。

![man in the middle mitm attack](https://user-images.githubusercontent.com/13888962/126036193-20b08345-f37d-40ff-9c76-c9c0993f5068.png)



中间人攻击主要有两个不同的阶段：**拦截**和**解密**。

## 拦截

即攻击者需要用户数据在到达目标设备前拦截并通过攻击者的网络。分为被动攻击和主动攻击。

常见的被动攻击（也是最简单）的方法，攻击者向公众提供免费的恶意 WiFi 热点，一旦有受害者连接了该热点，攻击者就能完全了解其所有的在线数据交换。

常见的主动攻击：

- **IP 欺骗** 攻击者通过更改 IP 地址中的数据包标头将自己伪装成应用程序。用户会被发送数据到攻击者的网站。
- **ARP 欺骗：** 攻击者利用 ARP 的漏洞，通过冒充网关或其他主机，使得到达网关或其他主机的流量通过攻击者主机进行转发。
- **DNS 欺骗：** 攻击者冒充域名服务器，将受害者查询的 IP 地址转发到攻击者的 IP 地址。

## 解密

拦截后，若连接是使用 HTTPS 协议即传递的数据用了 SSL / TLS 加密，这时还需要其他手段去解密用户数据。

**SSL 劫持（伪造证书）**

攻击者在 TLS 握手期间拦截到服务器返回的公钥后，将服务器的公钥替换成自己的公钥并返回给客户端，这样攻击者就能用自己的私钥去解密用户数据，也可以用服务器公钥解密服务器数据。

因为是伪造的证书，所以客户端在校验证书过程中会提示证书错误，若用户仍选择继续操作，此时中间人便能获取与服务端的通信数据。

**SSL 剥离**

攻击者拦截到用户到服务器的请求后，攻击者继续和服务器保持 HTTPS 连接，并与用户降级为不安全的 HTTP 连接。

服务器可以通过开启 HSTS（HTTP Strict Transport Security）策略，告知浏览器必须使用 HTTPS 连接。但是有个缺点是用户首次访问时因还未收到 HSTS 响应头而不受保护。

##  中间人攻击防范

对于开发者来说：

- 支持 HTTPS。
- 开启 HSTS 策略。

对于用户来说：

- 尽可能使用 HTTPS 链接。
- 避免连接不知名的 WiFi 热点。
- 不忽略不安全的浏览器通知。
- 公共网络不进行涉及敏感信息的交互。
- 用可信的第三方 CA 厂商，不下载来源不明的证书。

[参考](https://www.imperva.com/learn/application-security/man-in-the-middle-attack-mitm/)