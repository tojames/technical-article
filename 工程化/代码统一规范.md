# 代码统一规范

> 本文将详细讲解 **`前端代码统一规范`**，授人以鱼，不如授人以渔，不好意思这篇文章鱼和渔都有。所以涉及的范围将会比较广，使用到的第三方库有以下这些**「 Prettier、Eslint、Stylelint、husky、commitlint、lint-staged」**。阅读本文将会花费较长时间，因为你需要了解不同的插件。



## 问题

Eslint 和 Prettier 冲突怎么解决？

既然 node_modules 上安装了 Eslint、Prettier  为什么 vscode 还需要安装？





## 初始化

开局就是先一个初始化的项目，`npx create-react-app your-project-name `。

请把 vscode 全部插件禁用、settings.json全部注释。

干净又卫生的项目和编辑器出来了。



## 开工

往项目上开始添砖加瓦，一顿操作猛如虎，一看战绩零扛五。

### Prettier

一个美化项目代码的超高人气的库，自带配置即可使用，修改配置后不需要重启项目，但Eslint必须重启。

先在 vscode 上面安装 `Prettier - Code formatter` ，并且请**你仔细阅读这份英文文档，和 [Prettier 官网](https://prettier.io/docs/en/install.html) 这很重要。** 

我看到的意思是这样的

- 配置优先级的问题
  - 项目自带的配置 如：.prettierrc.js，优先级最高
  - 安装在全局或者项目外的的配置，优先级次之
  - 插件自带的，优先级最低
- vscode 怎么设置
  - ` "editor.defaultFormatter": "esbenp.prettier-vscode"`, 所有的格式化都使用 prettier。
  - vscode 也是可以设置 prettier 的配置的，但不推荐
  - `"editor.formatOnSave": true,` 它是控制编辑器保存的时候格式化，接着才会触发其他的格式化程序

其实这个时候，当你改乱了 javaScript 的代码 保存将会自动修复为较为好看的样子，但是我肯定是希望修改为我希望的样子，所以我创建了一个 `.prettierrc.js`，希望 prettier 按照我的意思去做，实际也是的。

```js
module.exports = {
  // 一行最多 80 字符
  printWidth: 120,
  // 使用 2 个空格缩进
  tabWidth: 2,
  // 不使用缩进符，而使用空格
  useTabs: false,
  // 行尾需要有分号
  semi: true,
  // 使用单引号
  singleQuote: true,
  // 对象的 key 仅在必要时用引号
  quoteProps: 'as-needed',
  // jsx 使用单引号
  jsxSingleQuote: true,
  // 末尾不需要逗号，需要则 all，有时候挺方便的，有时候也挺烦的
  trailingComma: 'none',
  // 大括号内的首尾需要空格
  bracketSpacing: true,
  // jsx 标签的反尖括号需要换行，true
  jsxBracketSameLine: false,
  // 箭头函数，只有一个参数的时候，也需要括号
  arrowParens: 'always',
  // 每个文件格式化的范围是文件的全部内容
  rangeStart: 0,
  rangeEnd: Infinity,
  // 不需要写文件开头的 @prettier
  requirePragma: false,
  // 不需要自动在文件开头插入 @prettier
  insertPragma: false,
  // 使用默认的折行标准
  proseWrap: 'preserve',
  // 根据显示样式决定 html 要不要折行
  htmlWhitespaceSensitivity: 'css',
  // 换行符使用 lf
  endOfLine: 'lf'
};
```

**我仍然需要在 node_modules 上下载这个包 `yarn add --dev --exact prettier`，为什么？**

这是回答上面提出的问题，编辑器安装的eslint和prettier在我们开发的时候会执行格式化工作，如果项目根目录下有 eslintrc 和prettierrc 配置文件，编辑器的插件会读取配置文件中的配置格式化代码，npm 安装的是在命令行中运行的。只安装 npm 包，编辑器是不会自动格式化代码，只能通过命令行运行插件才能格式化，

安装 npm 包最主要的原因是可以通过 git hook 强制提交代码前 lint 和格式化代码保证代码仓库的代码风格统一。

我们在配置规则的时候，可以在小黑窗「终端窗口-->输出--> ESlint/Prettier」查看 lint 配置信息和报错信息。

**Prettier 支持的配置文件类型**

JavaScript .prettierrc.js或prettier.config.js

JSON .prettierrc.json

YAML .prettierrc.yaml或.prettierrc.yml

TOML .prettierrc.toml 

我这些配置文件使用 .js 结尾的目的是为了能够让我写上注释，😂😂。



### stylelint

一个格式化 css 的库，它的规则其实和 Prettier 一样的。

先在 vscode 上面安装 `Stylelint` ，并且请**你仔细阅读这份英文文档，和 [Stylelint 官网](https://stylelint.io/user-guide/get-started) 这很重要。** 

我看到的意思是这样的

vscode 需要 配置 保存的时候格式化指令吗，不需要的，因为上面已经配置过了。

vscode 配置 ` "stylelint.validate": ["css", "less", "postcss", "scss", "vue", "sass"],`

这是因为，stylelint 默认支持 css postcss 显然不够的，这里加上所有的可能用上的

还是需要配置 `.stylelintrc.js`

```js
/* 
 安装： yarn add stylelint stylelint-config-standard stylelint-config-prettier -D
*/
module.exports = {
  extends: ['stylelint-config-standard', 'stylelint-config-prettier']
};

```



### Eslint

一个校验Javascript 和 typeScript 代码质量的库，微软出品，大家想必非常熟悉不用再介绍了。

先在 vscode 上面安装 `ESLint` ，并且请**你仔细阅读这份英文文档，和 [ESLint官网](https://eslint.org/docs/user-guide/getting-started) 这很重要。** 

先说明一下：Eslint 和 上面两个库可不一样，下载了Vscode 插件 并没有啥用的哦，还需要 下载 npm 包，还需配置 `.eslintrc.js`,并且它修改 `.eslintrc.js` 是需要重启项目才能有作用的。

我看到的意思是这样的

vscode 你需要设置成这样   "editor.codeActionsOnSave": {

  //   "source.fixAll": true // 保存的时候，所以的格式化程序自动修复，包括 eslint，未验证

  // },

这时候其实你还没有任何的作用，你需要 `yarn create @eslint/config`, 这样你可以选择很多的个性化选项定制你的ESlint，生成 .eslintrc.js 文件，在这个过程中，我希望你不要选 Airbnb，因为它会让你配置的更加困难，并且出现任何错误都会报错，显然这不是我想要的。

这时候，你的项目已经有了 eslint 校验了，如果你的代码出现的冲突，显然是 Eslint 和 Prettier 冲突了，你解决的方案 有两个 ，第一个 使用插件解决 `eslint-config-prettier, tslint-config-prettier`  让所有可能会与 prettier 规则存在冲突的 eslint rule，失效，并使用 prettier 的规则进行代码检查。相当于，用 prettier 的规则，覆盖掉 eslint:recommended 的部分规则。后面 prettier 格式化，也会根据这个规则来。因此，不会再有冲突。，第二个找到不一样的点，改为一样的

```js
module.exports = {
  env: {
    browser: true,
    es2021: true
  },
  extends: [
    'eslint:recommended',
    'plugin:react/recommended',
    'plugin:@typescript-eslint/recommended',
    'plugin:react-hooks/recommended'
  ],
  parser: '@typescript-eslint/parser',
  parserOptions: {
    ecmaFeatures: {
      jsx: true
    },
    ecmaVersion: 'latest',
    sourceType: 'module'
  },
  plugins: ['react', '@typescript-eslint', 'promise'],
  rules: {}
};

```





到了这里之后我们的代码格式化就已经结束了，但是还有就是  关于提交的问题

```
@typescript-eslint/eslint-plugin": "^5.18.0"
@typescript-eslint/parser": "^5.18.0"
eslint": "^8.12.0"
eslint-config-airbnb": "^19.0.4"
eslint-config-prettier": "^8.5.0"
eslint-plugin-import": "^2.26.0"
eslint-plugin-jsx-a11y": "^6.5.1"
eslint-plugin-react": "^7.29.4"
eslint-plugin-react-hooks": "^4.4.0"
prettier": "2.6.2"
typescript": "^4.6.3"


解决冲突ts： tslint-config-prettier
解决冲突js： eslint-config-prettier
```

```
 "@typescript-eslint/eslint-plugin": "^5.18.0",
    "@typescript-eslint/parser": "^5.18.0",
    "eslint": "^8.12.0",
    "eslint-plugin-react": "^7.29.4",
    "eslint-config-prettier": "^8.5.0",
    "eslint-plugin-import": "^2.26.0",
    "eslint-plugin-react-hooks": "^4.4.0",
    "prettier": "2.6.2",
    "typescript": "^4.6.3"
```



## Installation

请根据技术栈或使用需求选择安装相应lint包：

（不同技术栈会配置不同的插件和特殊规则）

#### js相关：

- [JS](#js)
- [JS + Typescript](#ts)
- [React](#react)
- [React + Typescript](#react-ts)
- [Vue](#vue)
- [Vue + Typescript](#vue-ts)

#### css相关：

- [css、less、scss](#css)

### JS

```
npm i -D @yunke/eslint-config-js
```

需额外安装的插件或辅助包如下（请根据安装@yunke/eslint-config-js时npm的提示安装对应的版本）：

```
"babel-eslint"
"eslint"
"eslint-plugin-import"
"eslint-plugin-promise"
```

### JS + Typescript

```
npm i -D @yunke/eslint-config-ts
```

需额外安装的插件或辅助包如下（请根据安装@yunke/eslint-config-ts时npm的提示安装对应的版本）：

```
"@typescript-eslint/eslint-plugin"
"@typescript-eslint/parser"
"eslint"
"eslint-plugin-import"
"eslint-plugin-promise"
"typescript"
```

### React

```
npm i -D @yunke/eslint-config-react
```

需额外安装的插件或辅助包如下（请根据安装@yunke/eslint-config-react时npm的提示安装对应的版本）：

```
"babel-eslint"
"eslint"
"eslint-plugin-import"
"eslint-plugin-promise"
"eslint-plugin-react"
"eslint-plugin-react-hooks"
```

### React + Typescript

```
npm i -D @yunke/eslint-config-react-ts
```

需额外安装的插件或辅助包如下（请根据安装@yunke/eslint-config-react-ts时npm的提示安装对应的版本）：

```
"@typescript-eslint/eslint-plugin"
"@typescript-eslint/parser"
"eslint"
"eslint-plugin-import"
"eslint-plugin-promise"
"eslint-plugin-react"
"eslint-plugin-react-hooks"
"typescript"
```

### Vue

```
npm i -D @yunke/eslint-config-vue
```

需额外安装的插件或辅助包如下（请根据安装@yunke/eslint-config-vue时npm的提示安装对应的版本）：

```
"babel-eslint"
"eslint"
"eslint-plugin-html"
"eslint-plugin-import"
"eslint-plugin-promise"
"eslint-plugin-vue"
```

### Vue + Typescript

```
npm i -D @yunke/eslint-config-vue-ts
```

需额外安装的插件或辅助包如下（请根据安装@yunke/eslint-config-vue-ts时npm的提示安装对应的版本）：

```
"@typescript-eslint/eslint-plugin"
"@typescript-eslint/parser"
"babel-eslint"
"eslint"
"eslint-plugin-html"
"eslint-plugin-import"
"eslint-plugin-promise"
"eslint-plugin-vue"
"typescript"
```

### css、less、scss

```
npm i -D @yunke/lint-style
```

需额外安装的插件或辅助包如下（请根据安装@yunke/lint-style时npm的提示安装对应的版本）：

```
"stylelint"
"stylelint-config-standard"
"stylelint-scss"
```

------

## Usage

### 一、增加配置文件

项目根目录中新建配置文件，然后extends相应lint包：

- eslint：

```
// .eslintrc.js
module.exports = {
  "extends": "@yunke/eslint-config-js", // 安装的对应lint包
  "rules": {
    // 自定义
  }
}
```

- stylelint：

```
// .stylelintrc.json
{
  "extends": "@yunke/lint-style",
  "rules": {
    // 自定义
  }
}
```

### 二、两种检查方式（推荐双管齐下）

#### 1、编辑器插件

安装编辑器对应lint插件：eslint、stylelint，在开发时做到实时提示

##### vscode不生效可能原因及解决方法：

- ①eslint未启用或执行报错：

  调出eslint控制台（点击vscode右下角eslint打开控制台， 如找不到，则，点击左下角设置按钮 --> 选择setting --> 输入eslint --> 把 `Eslint:Always Show Status` 和 `Eslint:Enable`勾选上 --> 点击任意js或ts文件则会出现，若还未出现请升级vscode版本），查看是否执行过程中出现错误

- ②vscode版本过低（请升级到1.41.1或以上）

  mac中如果遇到无法升级，则确认`vscode`是否在应用程序中，如不在则手动把`vscode`移到应用程序中方可进行升级

##### Auto fix 配置：

- ①打开编辑器设置文件（以vscode为例）：

```
// mac
command + P  -->  输入settings.json  --> 选择 settings.json文件

// windows
Ctrl + Shift + P --> 输入settings.json  --> 选择 Open Settings (JSON) 文件
```

- ②在文件中添加如下代码并保存：

```
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true,
    "source.fixAll.stylelint": true,
  },
```

- ③修改文件后保存，便会自动修复空格、顺序等风格问题

#### 2、eslint、styelint包

配合husky和lint-staged在commit时增量检查本次提交代码，不通过无法commit成功，参考一下配置：

```
// package.json
// 
"husky": {
    "hooks": {
      "pre-commit": "lint-staged",
    }
 },
"lint-staged": {
  "linters": {
    "*.(js|ts|tsx|jsx)": [
      "eslint",
      "git add"
    ],
    "*.(css|less|scss)": [
      "stylelint",
      "git add"
    ]
  },
  "ignore": [
    "appConfig/**/*",
    "node_modules/**/*",
    "img/**/*",
    "dist/**/*"
  ]
},
```



## 同时可以学习的网站

JavaScript Standard Style

https://github.com/standard/standard/blob/master/docs/RULES-zhcn.md#javascript-standard-style



推荐几个大厂的前端代码规范，你也能写出诗一样的代码！

https://mp.weixin.qq.com/s/XQQBiewGnG6ilqcdZKWzDw



我现在公司的前端操作规范

https://juejin.cn/post/6875893679656353805



css代码规范：

css代码规范工具stylelint

https://www.cnblogs.com/jiaoshou/p/11284204.html



Code Guide by @AlloyTeam

https://alloyteam.github.io/CodeGuide/



前端团队代码规范最佳实践，个人成长必备！

https://mp.weixin.qq.com/s/uVl-L-YB1KJdfnWPLBB7xw



vue 项目工程化规范

https://juejin.cn/post/6844903872553549832



Vue 前端代码开发规范

https://juejin.cn/post/7030637855290425374



前端开发规范：命名规范、html规范、css规范、js规范

https://juejin.cn/post/6844903479698259975



阿里前端开发规范

https://w3ctim.com/post/1d821dd8.html